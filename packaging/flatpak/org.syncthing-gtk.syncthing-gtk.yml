app-id: org.syncthinggtk.Syncthing-Gtk

runtime: org.gnome.Platform
runtime-version: '43'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
  - org.freedesktop.Sdk.Extension.golang

command: syncthing-gtk
rename-desktop-file: syncthing-gtk.desktop
rename-icon: syncthing-gtk

finish-args:
  # DBus access
  - --socket=session-bus
  # Wayland
  - --socket=wayland
  # Fallback X11 + XShm access
  - --socket=fallback-x11
  - --share=ipc
  # Folders for syncing can be anywhere
  - --filesystem=host
  # Network access for sync
  - --share=network
  # System tray icon
  - --talk-name=org.kde.StatusNotifierWatcher


# Cleanup after the python modules
cleanup:
  - /include
  - /lib/pkgconfig


# Ease rust modules build
build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
  env:
    CARGO_HOME: /run/build/python3-bcrypt/cargo
    CARGO_NET_OFFLINE: 'true'
    RUST_BACKTRACE: '1'
    RUSTFLAGS: -g
    # sccache hopefully speeds up subsequent compilations
    # RUSTC_WRAPPER: /app/bin/sccache
    # SCCACHE_DIR: /run/ccache/sccache/


modules:
  # Generated by flatpak-pip-generator -r requirements.txt
  - python3-requirements.json
  - python3-cargo-sources.yaml

  - syncthing.yaml


  - name: psmisc
    sources:
      - type: archive
        url: https://gitlab.com/psmisc/psmisc/-/archive/v23.6/psmisc-v23.6.tar.bz2
        sha256: 91573ca0a1a50bd491b7c3cbe400126b0dadef9a2e328030d6469bb2448e0794
        x-checker-data:
          type: anitya
          project-id: 3721
          url-template: https://gitlab.com/psmisc/psmisc/-/archive/v$version/psmisc-v$version.tar.bz2

    cleanup:
      - /bin/fuser
      - /bin/p*
      - /share/man

  - name: syncthing-gtk
    buildsystem: meson
    config-opts: []
      # - -Dbuild_man=false
    sources:
      - type: dir
        path: ../..
